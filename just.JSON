{"m1":"Zm9yIGkgaW4gcmFuZ2UgKDIsKGxlbihkYXRhKSArIDEpKTogZXhlYyhiYXNlNjQuYjY0ZGVjb2RlKGRhdGFbJ217fScuZm9ybWF0KGkpXSkuZGVjb2RlKCd1dGYtOCcpKQo=","m2":"aW1wb3J0IG9zCmltcG9ydCBvcy5wYXRoCgp0cnk6CiAgICBpbXBvcnQgdGltZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBvcy5zeXN0ZW0oInBpcCBpbnN0YWxsIHRpbWUiKQp0cnk6CiAgICBpbXBvcnQgcmVxdWVzdHMKZXhjZXB0IEltcG9ydEVycm9yOgogICAgb3Muc3lzdGVtKCJwaXAgaW5zdGFsbCByZXF1ZXN0cyIpCnRyeToKICAgIGltcG9ydCBzdWJwcm9jZXNzCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIG9zLnN5c3RlbSgicGlwIGluc3RhbGwgc3VicHJvY2VzcyIpCnRyeToKICAgIGltcG9ydCBzaGxleApleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBvcy5zeXN0ZW0oInBpcCBpbnN0YWxsIHNobGV4IikKdHJ5OgogICAgZnJvbSBjcnlwdG9ncmFwaHkuZmVybmV0IGltcG9ydCBGZXJuZXQKZXhjZXB0IEltcG9ydEVycm9yOgogICAgb3Muc3lzdGVtKCJwaXAgaW5zdGFsbCBjcnlwdG9ncmFwaHkiKQp0cnk6CiAgICBpbXBvcnQganNvbgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBvcy5zeXN0ZW0oInBpcCBpbnN0YWxsIGpzb24iKQoKdHJ5OgogICAgaW1wb3J0IHBsYXRmb3JtCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIG9zLnN5c3RlbSgicGlwIGluc3RhbGwgcGxhdGZvcm0iKQoKaW1wb3J0IHJhbmRvbQoKCmRlZiBlbmNyeXB0X21lc3NhZ2UobWVzc2FnZSwga2V5KToKICAgIEYgPSBGZXJuZXQoa2V5KQogICAgZW5jcnlwdGVkX21lc3NhZ2UgPSBGLmVuY3J5cHQobWVzc2FnZSkKICAgIHJldHVybiBlbmNyeXB0ZWRfbWVzc2FnZQoKCmRlZiBkZWNyeXB0X21lc3NhZ2UoZW5jcnlwdGVkX21lc3NhZ2UsIGtleSk6CiAgICBGID0gRmVybmV0KGtleSkKICAgIGRlY3J5cHRlZF9tZXNzYWdlID0gRi5kZWNyeXB0KGVuY3J5cHRlZF9tZXNzYWdlKS5kZWNvZGUoKQogICAgcmV0dXJuIGRlY3J5cHRlZF9tZXNzYWdlCgoKY2xhc3MgQWdlbnQ6CiAgICBkZWYgX19pbml0X18oc2VsZiwgbGlzdGVuZXJfaXAsIGxpc3RlbmVyX3BvcnQsIGFnZW50X25hbWUsIGFnZW50X2tleSk6CiAgICAgICAgc2VsZi5vdXRwdXQgPSBOb25lCiAgICAgICAgc2VsZi5saXN0ZW5lcl9pcCA9IGxpc3RlbmVyX2lwCiAgICAgICAgc2VsZi5saXN0ZW5lcl9wb3J0ID0gbGlzdGVuZXJfcG9ydAogICAgICAgIHNlbGYuYWdlbnRfbmFtZSA9IGFnZW50X25hbWUKICAgICAgICBzZWxmLmtleSA9IGFnZW50X2tleQogICAgICAgIHNlbGYuZmlsZV9uYW1lID0gTm9uZQogICAgICAgIHNlbGYuc3lzdGVtID0gTm9uZQogICAgICAgICMgUmVhZCBhZ2VudCBuYW1lIGZyb20gZmlsZSBpZiBpdCBleGlzdHMKCiAgICBkZWYgcmVnaXN0ZXIoc2VsZik6CiAgICAgICAgaG9zdCA9ICJob3N0bmFtZWN0bCIKICAgICAgICBob3N0bmFtZSA9IG9zLnBvcGVuKGhvc3QpLnJlYWQoKQogICAgICAgIHNlbGYuc3lzdGVtID0gcGxhdGZvcm0udW5hbWUoKS5zeXN0ZW0KCiAgICAgICAgIyBSZXRyaWV2ZSB0aGUgb3V0cHV0IG9mIHRoZSBjb21tYW5kCiAgICAgICAgbWFjID0gb3MucG9wZW4oImlwIGEgfCBncmVwIGV0aGVyIHwgYXdrICd7cHJpbnQgJDJ9JyIpLnJlYWQoKQogICAgICAgIG1hYyA9IG1hYwogICAgICAgIGdlb19pbmZvID0gb3MucG9wZW4oImN1cmwgaHR0cHM6Ly9pcGluZm8uaW8vIikucmVhZCgpCiAgICAgICAgbWFpbl9kYXRhID0gc3RyKHsiaG9zdG5hbWUiOiBob3N0bmFtZSwgIm1hYyI6IG1hYywgImdlb19pbmZvIjogZ2VvX2luZm99KQogICAgICAgIHBheWxvYWQgPSB7CiAgICAgICAgICAgICJob3N0bmFtZSI6IGhvc3RuYW1lLAogICAgICAgICAgICAibWFjIjogbWFjLAogICAgICAgICAgICAiZ2VvX2luZm8iOiBnZW9faW5mbwogICAgICAgIH0KCiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICBmImh0dHBzOi8ve3NlbGYubGlzdGVuZXJfaXB9OntzZWxmLmxpc3RlbmVyX3BvcnR9L3JlZy97c2VsZi5hZ2VudF9uYW1lfSIsCiAgICAgICAgICAgIGRhdGE9cGF5bG9hZCwgdmVyaWZ5PUZhbHNlCiAgICAgICAgKQoKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIGRhdGEgPSByZXNwb25zZS50ZXh0CiAgICAgICAgICAgIGRhdGFfZGljdCA9IGpzb24ubG9hZHMoZGF0YSkgICMgUGFyc2UgSlNPTiBzdHJpbmcgdG8gZGljdGlvbmFyeQogICAgICAgICAgICBzZWxmLmFnZW50X25hbWUgPSBkYXRhX2RpY3RbIm5hbWUiXQogICAgICAgICAgICBzZWxmLmtleSA9IGRhdGFfZGljdFsia2V5Il0KICAgICAgICAgICAgIyBTYXZlIGFnZW50IG5hbWUgdG8gYSBmaWxlCiAgICAgICAgICAgIHdpdGggb3BlbigiYWdlbnRfY3JlZC50eHQiLCAidyIpIGFzIGY6CiAgICAgICAgICAgICAgICBhZ2VudF9jcmVkID0ge3NlbGYuYWdlbnRfbmFtZTogc2VsZi5rZXl9CiAgICAgICAgICAgICAgICBqc29uLmR1bXAoYWdlbnRfY3JlZCwgZikKICAgICAgICAgICAgcHJpbnQoZiJBZ2VudCB7c2VsZi5hZ2VudF9uYW1lfSByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseSB3aXRoIExpc3RlbmVyLiIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIlJlZ2lzdHJhdGlvbiBmYWlsZWQuIikKICAgICAgICByZXR1cm4gc2VsZi5zeXN0ZW0KCiAgICAjIGRlZiB0YXNrX3dpbmRvd3Moc2VsZik6CgogICAgZGVmIHRhc2tfbGludXgoc2VsZik6CiAgICAgICAgIyBHZXQgdGFza3MgZnJvbSB0aGUgbGlzdGVuZXIKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgKICAgICAgICAgICAgZiJodHRwczovL3tzZWxmLmxpc3RlbmVyX2lwfTp7c2VsZi5saXN0ZW5lcl9wb3J0fS90YXNrcy97c2VsZi5hZ2VudF9uYW1lfSIsIHZlcmlmeT1GYWxzZQogICAgICAgICkKCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICB0YXNrX2V4ZWMgPSBkZWNyeXB0X21lc3NhZ2UoZW5jcnlwdGVkX21lc3NhZ2U9cmVzcG9uc2UudGV4dCwga2V5PXNlbGYua2V5KQogICAgICAgICAgICBpZiB0YXNrX2V4ZWM6CiAgICAgICAgICAgICAgICBwcmludCh0YXNrX2V4ZWMpCiAgICAgICAgICAgICAgICBmaWxlX21ldGEgPSB0YXNrX2V4ZWMubHN0cmlwKCkKICAgICAgICAgICAgICAgIGNvbW1hbmQsIF8sIGZpbGUgPSBmaWxlX21ldGEucGFydGl0aW9uKCIgIikKCiAgICAgICAgICAgICAgICAjIEZpbGUgc2VuZCB0byBzZXJ2ZXIKICAgICAgICAgICAgICAgIGlmIGNvbW1hbmQgPT0gImdldF9maWxlIjoKICAgICAgICAgICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8ve3NlbGYubGlzdGVuZXJfaXB9OntzZWxmLmxpc3RlbmVyX3BvcnR9L3NlbmRfZmlsZS97c2VsZi5hZ2VudF9uYW1lfSIKICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmaWxlKToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGUsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGYucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHsnRmlsZW5hbWUnOiBmaWxlLCAnZmlsZV9jb250ZW50JzogY29udGVudC5kZWNvZGUoKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0ganNvbi5kdW1wcyhkYXRhLCBlbnN1cmVfYXNjaWk9RmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEuZW5jb2RlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhMiA9IGVuY3J5cHRfbWVzc2FnZShkYXRhLCBzZWxmLmtleSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCwgZmlsZXM9eydmaWxlJzogbWV0YTJ9LCB2ZXJpZnk9RmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIkZpbGUge2ZpbGV9IHNlbnQgc3VjY2Vzc2Z1bGx5LiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHsicmVzdWx0IjogZW5jcnlwdF9tZXNzYWdlKGYiRmFpbGVkIHRvIHNlbmQgZmlsZSB7ZmlsZX0uIi5lbmNvZGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYua2V5KS5kZWNvZGUoKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLCBkYXRhPXBheWxvYWQsIHZlcmlmeT1GYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiRmFpbGVkIHRvIHNlbmQgZmlsZSB7ZmlsZX0uIikKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHsicmVzdWx0IjogZW5jcnlwdF9tZXNzYWdlKGYiRXJyb3Igc2VuZGluZyBmaWxlIHtmaWxlfToge3N0cihlKX0iLmVuY29kZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYua2V5KS5kZWNvZGUoKX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwsIGRhdGE9cGF5bG9hZCwgdmVyaWZ5PUZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IHsicmVzdWx0IjogZW5jcnlwdF9tZXNzYWdlKGYiRmlsZSB7ZmlsZX0gbm90IGZvdW5kLiIuZW5jb2RlKCksIHNlbGYua2V5KS5kZWNvZGUoKX0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLCBkYXRhPXBheWxvYWQsIHZlcmlmeT1GYWxzZQogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgIyBGaWxlIGRvd25sb2FkIGZyb20gc2VydmVyCiAgICAgICAgICAgICAgICBlbGlmIGNvbW1hbmQgPT0gImZpbGVfaW5zdGFsbCI6CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIGYiaHR0cHM6Ly97c2VsZi5saXN0ZW5lcl9pcH06e3NlbGYubGlzdGVuZXJfcG9ydH0vZG93bmxvYWQve3NlbGYuYWdlbnRfbmFtZX0ve2ZpbGV9IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmVyaWZ5PUZhbHNlCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgZW5jcnlwdGVkX2NvbnRlbnQgPSByZXNwb25zZS5jb250ZW50CiAgICAgICAgICAgICAgICAgICAgICAgICMgRGVjcnlwdCB0aGUgY29udGVudAogICAgICAgICAgICAgICAgICAgICAgICBkZWNyeXB0ZWRfY29udGVudCA9IGRlY3J5cHRfbWVzc2FnZShlbmNyeXB0ZWRfY29udGVudCwgc2VsZi5rZXkpCiAgICAgICAgICAgICAgICAgICAgICAgICMgU2F2ZSB0aGUgZmlsZSB0byAvdG1wIGRpcmVjdG9yeQogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oJy90bXAnLCBmaWxlKQogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAnd2InKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSA9IGRlY3J5cHRlZF9jb250ZW50LmVuY29kZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiRmlsZSAne2ZpbGV9JyBkb3dubG9hZGVkIHN1Y2Nlc3NmdWxseSB0byAvdG1wIGRpcmVjdG9yeS4iKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiRmFpbGVkIHRvIGRvd25sb2FkIGZpbGUgJ3tmaWxlfScgZnJvbSBzZXJ2ZXIuIikKCgogICAgICAgICAgICAgICAgIyBDb21tYW5kIGV4ZWN1dGUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjIEV4ZWN1dGUgdGhlIHRhc2sKICAgICAgICAgICAgICAgICAgICAgICAgaG9zdG5hbWVfcHJvY2VzcyA9IHN1YnByb2Nlc3MuUG9wZW4oc2hsZXguc3BsaXQodGFza19leGVjKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlKQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBSZXRyaWV2ZSB0aGUgb3V0cHV0IG9mIHRoZSBjb21tYW5kCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dCwgXyA9IGhvc3RuYW1lX3Byb2Nlc3MuY29tbXVuaWNhdGUoKQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBFeHRyYWN0IHRoZSBob3N0bmFtZSBmcm9tIHRoZSBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQob3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm91dHB1dCA9IG91dHB1dC5lbmNvZGUoKQoKICAgICAgICAgICAgICAgICAgICAgICAgIyBTZW5kIHJlc3VsdHMgYmFjayB0byB0aGUgbGlzdGVuZXIKCiAgICAgICAgICAgICAgICAgICAgICAgIGVuY3J5cHRlZF9vdXRwdXQgPSBlbmNyeXB0X21lc3NhZ2Uoc2VsZi5vdXRwdXQsIHNlbGYua2V5KQogICAgICAgICAgICAgICAgICAgICAgICBwYXlsb2FkID0geyJyZXN1bHQiOiBlbmNyeXB0ZWRfb3V0cHV0LmRlY29kZSgpfQogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmImh0dHBzOi8ve3NlbGYubGlzdGVuZXJfaXB9OntzZWxmLmxpc3RlbmVyX3BvcnR9L3Jlc3VsdHMve3NlbGYuYWdlbnRfbmFtZX0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YT1wYXlsb2FkLCB2ZXJpZnk9RmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlRhc2sgZXhlY3V0ZWQgYW5kIHJlc3VsdHMgc2VudCBzdWNjZXNzZnVsbHkuIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KHJlc3BvbnNlLnN0YXR1c19jb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIkZhaWxlZCB0byBzZW5kIHJlc3VsdHMgdG8gdGhlIGxpc3RlbmVyLiIpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiWW91ciBlcnJvciBtZXNzYWdlIC0tPiIsIHN0cihlKSkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vdXRwdXQgPSAiVGhlcmUgaXMgYSBwcm9ibGVtIgogICAgICAgICAgICAgICAgICAgICAgICAjIElmIHRoZSB0YXNrIGV4ZWN1dGlvbiBmYWlscwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBzZWxmLm91dHB1dAogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRfYnl0ZXMgPSBzZWxmLm91dHB1dC5lbmNvZGUoKQogICAgICAgICAgICAgICAgICAgICAgICAjIEVuY3J5cHQgdGhlIG91dHB1dAogICAgICAgICAgICAgICAgICAgICAgICBlbmNyeXB0ZWRfb3V0cHV0ID0gZW5jcnlwdF9tZXNzYWdlKG91dHB1dF9ieXRlcywgc2VsZi5rZXkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBheWxvYWQgPSB7InJlc3VsdCI6IGVuY3J5cHRlZF9vdXRwdXQuZGVjb2RlKCl9CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYiaHR0cHM6Ly97c2VsZi5saXN0ZW5lcl9pcH06e3NlbGYubGlzdGVuZXJfcG9ydH0vcmVzdWx0cy97c2VsZi5hZ2VudF9uYW1lfSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhPXBheWxvYWQsIHZlcmlmeT1GYWxzZQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiRmFpbGVkIHRvIGV4ZWN1dGUgdGFzazoge291dHB1dH0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIk5vIHRhc2tzIGF2YWlsYWJsZS4iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgcHJpbnQoIkZhaWxlZCB0byBmZXRjaCB0YXNrcyBmcm9tIHRoZSBsaXN0ZW5lci4iKQogICAgICAgICAgICBwYXNzCiAgICAgICAgeSA9IHJhbmRvbS5yYW5kcmFuZ2UoNykKICAgICAgICB0aW1lLnNsZWVwKHkpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgICMgUmVwbGFjZSB3aXRoIHRoZSBhY3R1YWwgSVAgYWRkcmVzcyBhbmQgcG9ydCBvZiB0aGUgbGlzdGVuZXIKICAgIExJU1RFTkVSX0lQID0gIjE5Mi4xNjguMTEwLjEwNyIKICAgIExJU1RFTkVSX1BPUlQgPSA1MDAwCiAgICBpZiBvcy5wYXRoLmV4aXN0cygiYWdlbnRfY3JlZC50eHQiKToKICAgICAgICB3aXRoIG9wZW4oImFnZW50X2NyZWQudHh0IiwgInIiKSBhcyBmOgogICAgICAgICAgICBhZ2VudF9kYXRhID0ganNvbi5sb2FkKGYpCiAgICAgICAgICAgIGFnZW50X25hbWUgPSBsaXN0KGFnZW50X2RhdGEua2V5cygpKVswXQogICAgICAgICAgICBhZ2VudF9rZXkgPSBhZ2VudF9kYXRhW2FnZW50X25hbWVdCiAgICAgICAgcHJpbnQoZiJBZ2VudCB7YWdlbnRfbmFtZX0gcmV0cmlldmVkIGZyb20gZmlsZS4iKQogICAgICAgIGFnZW50ID0gQWdlbnQoTElTVEVORVJfSVAsIExJU1RFTkVSX1BPUlQsIGFnZW50X25hbWU9YWdlbnRfbmFtZSwgYWdlbnRfa2V5PWFnZW50X2tleSkKICAgIGVsc2U6CiAgICAgICAgYWdlbnQgPSBBZ2VudChMSVNURU5FUl9JUCwgTElTVEVORVJfUE9SVCwgYWdlbnRfbmFtZT1Ob25lLCBhZ2VudF9rZXk9Tm9uZSkKICAgIHN5c3RlbSA9IGFnZW50LnJlZ2lzdGVyKCkKICAgIHdoaWxlIFRydWU6CiAgICAgICAgaWYgc3lzdGVtID09ICJMaW51eCI6CiAgICAgICAgICAgIGFnZW50LnRhc2tfbGludXgoKQo="}
